
Fitting transition charges to transition densities
==================================================

In this example you will learn how to fit atom-centered transition charges for
the pi-pi* transition of ethene. At the PBE/6-31+G* level of theory the pi-pi*
state is labelled as S3.

The Gaussian input file `ethene.gjf` contains route section needed for computing
the lowest 4 excited states of ethene. The IOp(9/40=5) instructs Gaussian to write
out all excitation coefficients > 10^-5. 

After completing the Gaussian calculation,

   g09 < ethene.gjf > ethene.out

we need to create a formatted checkpoint file with

   formchk ethene.chk

This checkpoint file can be read with the program `Multiwfn` (http://sobereva.com/multiwfn/):

   Multiwfn ethene.fchk

Navigate through the Multiwfn menu and save the transition density for the S0->S3 transition
to a cube file (called `transdens.cub`): 18 // 1 // ethene.out // 3 // 1 // 2 // 13

   echo -e "18\n1\nethene.out\n3\n1\n2\n13\n" | Multiwfn ethene.fchk | tee multiwfn.out

Rename the cube file:

   mv transdens.cub td_S0-S3.cube

Now we have to compute the electrostatic potential generated by the transition density. For
transition densities the nuclei do not contribute to the potential.

   electrostatic_potential.py td_S0-S3.cube td_pot_S0-S3.cube --nuclear_potential=0

`td_pot_S0-S3.cube` will contain the electrostatic potential evaluated on the grid.
Finally transition charges are fitted using the CHELPG algorithm:

   fit_electric_charges.py td_pot_S0-S3.cube transition_charges_S0-S3.dat

Finally the following table with transition charges is printed:

  root mean square deviation V(electrostatic) - V(monopoles): 3.552961e-03
  sum of charges: -2.77555756156e-17
  dipole vector of charge distribution: +0.00000  +0.00000  -1.20345

  #       Element      Monopole charge
  =========================================
  0        C           -0.83238
  1        H           +0.10130
  2        H           +0.10129
  3        C           +0.83244
  4        H           -0.10134
  5        H           -0.10133

